# 步骤20：后端支持动态尺寸 - 测试清单

## 测试目标

验证后端能够正确接收前端传入的尺寸参数，并根据这些参数动态生成符合预期尺寸的拼接图片。

---

## 测试场景

### 场景 1：默认尺寸测试 ✅

**测试步骤：**
1. 打开图片拼接页面
2. 添加3张图片到素材库
3. 拖拽图片到画布（左侧、右上、右下）
4. 保持默认尺寸（800×800, 400×400, 400×400）
5. 点击"生成"按钮

**预期结果：**
- 生成成功
- 图片实际尺寸：1200 × 800 像素
- 画布尺寸：1200 × 800 像素
- 尺寸匹配：✅ 成功

**验证方法：**
- 查看生成结果区域的尺寸信息
- 查看浏览器控制台的验证日志
- 查看 Python 服务控制台的尺寸配置日志

---

### 场景 2：自定义尺寸测试 ✅

**测试步骤：**
1. 打开图片拼接页面
2. 添加3张图片到素材库
3. 拖拽图片到画布
4. 调整尺寸为：770×780, 380×380, 390×360
5. 点击"生成"按钮

**预期结果：**
- 生成成功
- 图片实际尺寸：1150 × 780 像素（770+380=1150, max(780, 380+360)=780）
- 画布尺寸：1150 × 780 像素
- 尺寸匹配：✅ 成功

**验证方法：**
- 查看生成结果区域的尺寸信息
- 查看浏览器控制台的验证日志
- 查看 Python 服务控制台的尺寸配置日志

---

### 场景 3：极端尺寸测试

**测试步骤：**
1. 调整尺寸为最小值：200×200, 200×200, 200×200
2. 点击"生成"按钮

**预期结果：**
- 生成成功
- 图片实际尺寸：400 × 400 像素
- 尺寸匹配：✅ 成功

---

### 场景 4：最大尺寸测试

**测试步骤：**
1. 调整尺寸为最大值：1200×1200, 1200×1200, 1200×1200
2. 点击"生成"按钮

**预期结果：**
- 生成成功
- 图片实际尺寸：2400 × 2400 像素
- 尺寸匹配：✅ 成功

---

### 场景 5：不同宽高比测试

**测试步骤：**
1. 调整尺寸为：宽大于高（800×600, 400×300, 400×300）
2. 点击"生成"按钮
3. 调整尺寸为：高大于宽（600×800, 300×400, 300×400）
4. 点击"生成"按钮

**预期结果：**
- 两种情况下都能成功生成
- 尺寸匹配：✅ 成功

---

## 验证要点

### 1. 尺寸参数传递
- [ ] 前端正确发送尺寸参数（查看浏览器控制台）
- [ ] API 网关正确转发请求（查看 API 网关控制台）
- [ ] Python 服务正确接收参数（查看 Python 服务控制台）

### 2. 尺寸计算
- [ ] 画布宽度 = 左侧宽度 + 右上宽度
- [ ] 画布高度 = max(左侧高度, 右上高度+右下高度)
- [ ] 与前端计算逻辑一致

### 3. 图片生成
- [ ] 生成的图片尺寸与预期一致
- [ ] 图片质量正常
- [ ] 图片布局正确（左侧大图，右上右下小图）

### 4. 尺寸验证
- [ ] 生成结果区域显示实际尺寸
- [ ] 生成结果区域显示预期画布尺寸
- [ ] 控制台显示尺寸匹配结果

---

## 测试结果记录

### 测试时间：2025-12-24

| 测试场景 | 输入尺寸 | 预期尺寸 | 实际尺寸 | 结果 |
|---------|---------|---------|---------|------|
| 默认尺寸 | 800×800, 400×400, 400×400 | 1200×800 | 1200×800 | ✅ 通过 |
| 自定义尺寸 | 770×780, 380×380, 390×360 | 1150×780 | 1150×780 | ✅ 通过 |

---

## 注意事项

1. **服务重启**：修改代码后需要重启对应的服务
2. **路径格式**：确保图片路径包含 Session ID
3. **尺寸范围**：限制在 200-1200px 范围内
4. **向后兼容**：如果前端未传尺寸参数，使用默认值

---

## 相关文件

- `video-service/app.py` - 后端拼接接口
- `frontend/src/views/ImageStitch.vue` - 前端生成函数
- `api-gateway/server.js` - API 网关转发逻辑


