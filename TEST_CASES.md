# 边界情况测试用例

**日期**：2025年12月27日  
**测试目标**：验证广告投放表格生成功能的边界情况处理

---

## 一、3:1分组校验测试（拼图对齐模式）

### 测试场景1：外链数量与商品ID数量完全匹配（正常情况）

**测试数据**：
- 外链数量：3个
- 商品ID数量：9个（3 × 3）
- 商品SPU数量：9个

**预期结果**：
- ✅ 校验通过
- ✅ 生成3行表格（每行包含3个商品ID/SPU，用逗号分隔）

---

### 测试场景2：商品ID数量不足（少一行）

**测试数据**：
- 外链数量：3个
- 商品ID数量：8个（缺少1个）
- 商品SPU数量：8个

**预期结果**：
- ❌ 校验失败
- ✅ 错误提示：`第 3 组外链缺失对应的商品ID，请检查第 7-9 行`
- ✅ 提示信息包含具体的组号和行号范围

**验证公式**：
- 第3组对应的行号范围：起始行 = (3-1)*3+1 = 7，结束行 = (3-1)*3+3 = 9

---

### 测试场景3：商品ID数量过多（多一行）

**测试数据**：
- 外链数量：3个
- 商品ID数量：10个（多出1个）
- 商品SPU数量：10个

**预期结果**：
- ❌ 校验失败
- ✅ 错误提示：`当前有 3 个外链，需要 9 个商品ID。但实际检测到 10 个商品ID。`
- ✅ 提示信息说明数据过多

---

### 测试场景4：商品ID和商品SPU数量不匹配

**测试数据**：
- 外链数量：3个
- 商品ID数量：9个
- 商品SPU数量：8个（缺少1个）

**预期结果**：
- ❌ 校验失败（先通过行数相等校验）
- ✅ 错误提示：`第 9 行缺失商品SPU，请检查并补齐。`
- ✅ 提示信息包含具体的行号

---

### 测试场景5：中间有空行

**测试数据**：
- 外链数量：3个
- 商品ID：第1-6行有数据，第7行为空，第8-9行有数据
- 商品SPU：第1-9行都有数据

**预期结果**：
- ❌ 校验失败（空行会被过滤，实际只有8个商品ID）
- ✅ 错误提示：`第 3 组外链缺失对应的商品ID，请检查第 7-9 行`
- ✅ 系统正确识别空行并统计有效数据

---

### 测试场景6：开头有空行

**测试数据**：
- 外链数量：3个
- 商品ID：第1行为空，第2-10行有数据（共9个有效ID）
- 商品SPU：第1-10行都有数据（共10个有效SPU）

**预期结果**：
- ❌ 校验失败
- ✅ 错误提示：`第 10 行缺失商品SPU，请检查并补齐。`（因为ID有9个，SPU有10个）

---

### 测试场景7：末尾有空行

**测试数据**：
- 外链数量：3个
- 商品ID：第1-9行有数据，第10行为空
- 商品SPU：第1-9行有数据，第10行为空

**预期结果**：
- ✅ 校验通过（空行被过滤，实际9个ID和9个SPU，符合3:1关系）
- ✅ 生成3行表格

---

### 测试场景8：多个连续空行

**测试数据**：
- 外链数量：3个
- 商品ID：第1-6行有数据，第7-9行为空，第10-12行有数据（共9个有效ID）
- 商品SPU：第1-12行都有数据（共12个有效SPU）

**预期结果**：
- ❌ 校验失败
- ✅ 错误提示：`商品ID有 9 行，商品SPU有 12 行`

---

## 二、模式切换测试

### 测试场景1：有映射数据时切换模式

**前置条件**：
- 当前模式：拼图对齐模式
- 已导入Excel数据（productDataMapping中有映射数据）

**操作**：
- 切换到标准模式

**预期结果**：
- ✅ 弹出确认对话框：`切换模式将清空当前的对齐映射数据，是否继续？`
- ✅ 点击"继续切换"：模式切换成功，映射数据被清空
- ✅ 点击"取消"：模式保持不变，映射数据不清理，表单文本也不清理

---

### 测试场景2：无映射数据时切换模式

**前置条件**：
- 当前模式：标准模式
- 无映射数据（productDataMapping为空）

**操作**：
- 切换到拼图对齐模式

**预期结果**：
- ✅ 不弹出确认对话框
- ✅ 直接切换模式
- ✅ 显示提示：`已切换到拼图对齐模式，将启用3:1强校验`

---

## 三、文件下载错误处理测试

### 测试场景1：浏览器阻止下载（InvalidStateError）

**操作**：
- 在浏览器设置中阻止自动下载
- 点击"生成表格"按钮

**预期结果**：
- ✅ 捕获 InvalidStateError
- ✅ 显示错误提示：`导出失败，请检查浏览器是否拦截了下载，或者尝试允许自动下载。`
- ✅ 页面不卡死，可以继续操作

---

### 测试场景2：文件名过长

**操作**：
- 创建一个文件名超过系统限制长度的文件（例如：超过255个字符）

**预期结果**：
- ✅ 捕获文件名错误
- ✅ 显示错误提示：`导出失败，文件名可能包含非法字符或过长，请检查文件名。`
- ✅ 页面不卡死

---

### 测试场景3：存储空间不足

**操作**：
- 在磁盘空间不足的情况下尝试下载大文件

**预期结果**：
- ✅ 捕获存储空间错误（如果浏览器支持）
- ✅ 显示错误提示：`导出失败，存储空间可能不足，请清理磁盘空间后重试。`
- ✅ 页面不卡死

---

## 四、数据对齐测试

### 测试场景1：用户手动删除外链后重新同步

**前置条件**：
- 已导入Excel数据
- 已同步3个外链到表单

**操作**：
1. 手动删除表单中的3个外链（清空"商品图片链接"文本框）
2. 重新从拼图页面同步3个新的外链

**预期结果**：
- ✅ 校验基于表单中的实际外链数量（3个新外链）
- ✅ 不依赖Store中的旧数据（旧映射数据保留，但不参与校验计数）
- ✅ 如果商品ID数量是9个，校验应该通过

---

### 测试场景2：部分外链缺失对应的商品ID

**测试数据**：
- 外链数量：3个
- 商品ID：只有6个（第1-2组完整，第3组缺失）

**预期结果**：
- ❌ 校验失败
- ✅ 错误提示：`第 3 组外链缺失对应的商品ID，请检查第 7-9 行`
- ✅ 行号计算正确：起始行 = (3-1)*3+1 = 7，结束行 = (3-1)*3+3 = 9

---

## 五、标准模式测试（确保不影响原有功能）

### 测试场景1：标准模式1:1逻辑

**前置条件**：
- 当前模式：标准模式

**测试数据**：
- 商品ID：5个
- 商品SPU：5个
- 商品图片链接：5个

**预期结果**：
- ✅ 校验通过（不进行3:1校验）
- ✅ 生成5行表格（1:1对应）

---

### 测试场景2：标准模式 + 轮播视频模式

**前置条件**：
- 当前模式：标准模式
- 启用"轮播视频模式"

**测试数据**：
- 商品ID：9个
- 商品SPU：9个
- 商品图片链接：3个

**预期结果**：
- ✅ 使用3:1分组逻辑
- ✅ 生成3行表格（每行包含3个商品ID/SPU，用逗号分隔）

---

## 六、测试检查清单

### 核心功能测试
- [ ] 拼图对齐模式3:1分组逻辑（正常情况）
- [ ] 商品ID数量不足（少一行）
- [ ] 商品ID数量过多（多一行）
- [ ] 商品ID和商品SPU数量不匹配
- [ ] 中间有空行
- [ ] 开头有空行
- [ ] 末尾有空行
- [ ] 多个连续空行

### 模式切换测试
- [ ] 有映射数据时切换模式（确认对话框）
- [ ] 无映射数据时切换模式（直接切换）
- [ ] 切换模式时取消（数据不清理）

### 错误处理测试
- [ ] 浏览器阻止下载（InvalidStateError）
- [ ] 文件名过长错误
- [ ] 存储空间不足错误
- [ ] 错误提示信息精准（包含具体行号和组号）

### 数据对齐测试
- [ ] 用户手动删除外链后重新同步
- [ ] 部分外链缺失对应的商品ID

### 标准模式测试
- [ ] 标准模式1:1逻辑正常
- [ ] 标准模式 + 轮播视频模式3:1分组正常

---

## 七、测试注意事项

1. **行号计算验证**：
   - 确保错误提示中的行号与textarea中的实际行号一致
   - 验证公式：起始行 = (groupIndex-1)*3+1，结束行 = (groupIndex-1)*3+3

2. **空行处理**：
   - 空行应该被过滤（不参与计数）
   - 但行号计算应该基于实际有效数据的位置

3. **数据一致性**：
   - 校验基于表单实时数据，不依赖Store
   - Store仅作为映射字典，不参与计数

4. **错误提示精准性**：
   - 错误提示应该包含具体的行号和组号
   - 用户看到提示后，可以直接在文本框中定位到问题位置

---

**最后更新**：2025年12月27日  
**测试状态**：待测试


